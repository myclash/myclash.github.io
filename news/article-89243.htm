<!DOCTYPE html>
<html class="no-js" lang="zh-CN">

<head>
        <link rel="canonical" href="https://myclash.github.io/news/article-89243.htm" />
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>Android中Handler的使用方法</title>
        <meta name="description" content="Android中Handler的使用方法 几乎所有人第一次使用到Handler类的时候，都是因为想在非主线程更新UI，然后在更新UI的时候报错，才发现Handler的，现在来看一下网上的通用给法  “" />
        <link rel="icon" href="/assets/website/img/myclash/favicon.ico" type="image/x-icon"/>

    <meta name="author" content="MyClash官网每日更新站">
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://myclash.github.io/news/article-89243.htm" />
    <meta property="og:site_name" content="MyClash官网每日更新站" />
    <meta property="og:title" content="Android中Handler的使用方法" />
    <meta property="og:image" content="https://myclash.github.io/uploads/20240710/5542f8b2c496e9eed254f7eda5bf0a10.webp" />
        <meta property="og:release_date" content="2025-04-05T08:21:15" />
    <meta property="og:updated_time" content="2025-04-05T08:21:15" />
        <meta property="og:description" content="Android中Handler的使用方法 几乎所有人第一次使用到Handler类的时候，都是因为想在非主线程更新UI，然后在更新UI的时候报错，才发现Handler的，现在来看一下网上的通用给法  “" />
        
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta name="applicable-device" content="pc,mobile" />
    <meta name="renderer" content="webkit" />
    <meta name="force-rendering" content="webkit" />
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta name="robots" content="max-image-preview:large" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="Android中Handler的使用方法">
    <meta name="format-detection" content="telephone=no">

    <link rel="dns-prefetch" href="https:/www.googletagmanager.com">
    <link rel="dns-prefetch" href="https://www.googleadservices.com">
    <link rel="dns-prefetch" href="https://www.google-analytics.com">
    <link rel="dns-prefetch" href="https://pagead2.googlesyndication.com">
    <link rel="dns-prefetch" href="https://cm.g.doubleclick.net">
    
    <!-- Place favicon.ico in the root directory -->
    <!-- ========================= CSS here ========================= -->
    <link rel="stylesheet" href="/assets/website/css/myclash/bootstrap-5.0.0-alpha-2.min.css" />
    <link rel="stylesheet" href="/assets/website/css/myclash/LineIcons.2.0.css" />
    <link rel="stylesheet" href="/assets/website/css/myclash/animate.css" />
    <link rel="stylesheet" href="/assets/website/css/myclash/tiny-slider.css" />
    <link rel="stylesheet" href="/assets/website/css/myclash/glightbox.min.css" />
    <link rel="stylesheet" href="/assets/website/css/myclash/lindy-uikit.css" />
    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-JV5DZ5QQPV"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-JV5DZ5QQPV');
</script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3332997411212854"
     crossorigin="anonymous"></script>
</head>

<body data-page="detail">
    <!--[if lte IE 9]>
      <p class="browserupgrade">
        You are using an <strong>outdated</strong> browser. Please
        <a href="https://browsehappy.com/">upgrade your browser</a> to improve
        your experience and security.
      </p>
    <![endif]-->
    <!-- ========================= preloader start ========================= -->
    <div class="preloader">
        <div class="loader">
            <div class="spinner">
                <div class="spinner-container">
                    <div class="spinner-rotator">
                        <div class="spinner-left">
                            <div class="spinner-circle"></div>
                        </div>
                        <div class="spinner-right">
                            <div class="spinner-circle"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- ========================= preloader end ========================= -->
    <!-- ========================= hero-section-wrapper-2 start ========================= -->
    <section id="home" class="hero-section-wrapper-2 list">
                <!-- ========================= header-2 start ========================= -->
        <header class="header header-2">
            <div class="navbar-area">
                <div class="container">
                    <div class="row align-items-center">
                        <div class="col-lg-12">
                            <nav class="navbar navbar-expand-lg">
                                <a class="navbar-brand xcblog-blog-logo" href="/">
                                                                        <span>MyClash</span>
                                                                    </a>
                                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent2" aria-controls="navbarSupportedContent2" aria-expanded="false" aria-label="Toggle navigation">
                                    <span class="toggler-icon"></span>
                                    <span class="toggler-icon"></span>
                                    <span class="toggler-icon"></span>
                                </button>
                                <div class="collapse navbar-collapse sub-menu-bar" id="navbarSupportedContent2">
                                    <ul id="nav2" class="navbar-nav ml-auto">
                                                                                <li class="nav-item">
                                            <a href="/">首页</a>
                                        </li>
                                                                                <li class="nav-item">
                                            <a href="/free-nodes/">免费节点</a>
                                        </li>
                                                                                <li class="nav-item">
                                            <a href="/paid-subscribe/">推荐机场</a>
                                        </li>
                                                                                <li class="nav-item">
                                            <a href="/client.htm">客户端</a>
                                        </li>
                                                                                <li class="nav-item">
                                            <a href="/news/">新闻资讯</a>
                                        </li>
                                                                            </ul>
                                </div>
                                <!-- navbar collapse -->
                            </nav>
                            <!-- navbar -->
                        </div>
                    </div>
                    <!-- row -->
                </div>
                <!-- container -->
            </div>
            <!-- navbar area -->
        </header>
        <!-- ========================= header-2 end ========================= -->
        <!-- ========================= hero-2 start ========================= -->
        <div class="hero-section hero-style-2">
            <div class="container">
                <div class="row align-items-end">
                    <div class="col-lg-6">
                        <div class="hero-content-wrapper">
                            <h1 class="mb-30 wow fadeInUp" data-wow-delay=".4s">Android中Handler的使用方法</h1>
                            <p class="mb-50 wow fadeInUp" data-wow-delay=".6s">
                                <a href="/">首页</a> / <a href="/news/">新闻资讯</a> / <span>正文</span>
                            </p>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="hero-image">
                            <img src="/assets/website/img/myclash/hero/hero-2/hero-img.svg" alt="" class="wow fadeInRight" data-wow-delay=".2s">
                            <img src="/assets/website/img/myclash/hero/hero-2/paattern.svg" alt="" class="shape shape-1">
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- ========================= hero-2 end ========================= -->
    </section>
    <!-- ========================= hero-section-wrapper-2 end ========================= -->
    <!-- ========================= about style-3 start ========================= -->
    <section id="about" class="about-section about-style-3">
        <div class="container">
            <div class="row">
                <div class="col-md-9">
                                    <input type="hidden" id="share-website-info" data-name="" data-url="">
                  				  				  				<div id="content_views" class="markdown_views prism-atom-one-dark"> <h2 id="android中handler的使用方法">Android中Handler的使用方法</h2> <p>几乎所有人第一次使用到Handler类的时候，都是因为想在非主线程更新UI，然后在更新UI的时候报错，才发现Handler的，现在来看一下网上的通用给法 <br /> “</p> <pre><code>public class HandlerActivity extends Activity {  private Handler mHandler=new Handler(){     @Override     public void handleMessage(Message msg) {         switch(msg.what){             case 1:             //更新UI             break;          }         super.handleMessage(msg);     } }; @Override protected void onCreate(Bundle savedInstanceState) {     super.onCreate(savedInstanceState);      new Thread(new Runnable() {         @Override         public void run() {             Message msg=new Message();             msg.what=1;             mHandler.sendMessage(msg);         }     }).start(); } </code></pre> <p>} <br /> “ <br /> 我们通过新建一个Handler对象，然后在子线程中进行业务处理，当处理完成中再将信号通过mHandler发送到主线程中，Handler再收到消息后就会对其进行处理。在使用Android Studio的时候，细心的同学会发现，Handler中给出了警告提示： <br /> Since this Handler is declared as an inner class, it may prevent the outer class from being garbage collected. If the Handler is using a Looper or MessageQueue for a thread other than the main thread, then there is no issue. If the Handler is using the Looper or MessageQueue of the main thread, you need to fix your Handler declaration, as follows: Declare the Handler as a static class; In the outer class, instantiate a WeakReference to the outer class and pass this object to your Handler when you instantiate the Handler; Make all references to members of the outer class using the WeakReference object. <br /> 一旦Handler被声明为内部类，可能导致它的外部类不能被垃圾回收。如果Handler是在其他线程使用Looper或MessageQueue，而不是在UI线程，那么就没有这个问题。如果Handler使用Looper或MessageQueue在主线程（main thread），你需要修改你的Handler声明： <br /> 声明Handler为static类；在外部类中实例化一个外部类的WeakReference（弱引用）并且在Handler初始化时传入这个对象给你的Handler；将所有引用的外部类成员使用WeakReference对象。</p> <p>出现这个问题的主要原因是，当结束Activity时由于外部对handler 有一个引用，而handler 持有Activity的引用，这样就导致了GC不会回收，引发内存泄露，GC的回收机制是，如果某个对象不再被引用，那么该对象将被回收。如 A a=new A（），此时就创建一个对象A，a去引用，但是如果我们将a=null;后，由于对象A不再被引用，对象A就会被回收。所以，如一些需要在对象销毁时才执行的函数，如Activity的onDestroy，由于Activity没有被回收，导致内存泄露 ，引发的并发问题onDestroy不能被执行，有时候当某个函数不能被正常调用时，应该考虑是否内存泄露引发的，其实这种问题在C/C++中经常出现，只是java 弱化了指针的概念（或者说没有指针这个东西），导致JAVA中对内存泄露不是特别重视。</p> <p>说了这么多废话 该说一下如何解决了，根据这个警告提到的我们可以使用弱引用，来解决这个问题。使用静态内部类，通过WeakReference实现对Activity的弱引用，直接上代码： <br /> “</p> <pre><code>public class HandlerActivity extends Activity {  private static class WeakReferenceHandler extends Handler{     WeakReference&lt;HandlerActivity&gt; mActivity;     private String TAG="StudentSocreHandler";     public WeakReferenceHandler(HandlerActivity activity){         mActivity=new WeakReference&lt;&gt;(activity);     }     @Override     public void handleMessage(Message msg) {         HandlerActivity mHandlerActivity=mActivity.get();         switch (msg.what){             case 1:                 //更新UI 通过mHandlerActivity得到Activity中的对象                  break;         }         super.handleMessage(msg);     } } private WeakReferenceHandler mWeakReferenceHandler=new WeakReferenceHandler(this); @Override protected void onCreate(Bundle savedInstanceState) {     super.onCreate(savedInstanceState);     Work.WorkThread(mWeakReferenceHandler); } } </code></pre> <p><code> <br /></code></p> <pre><code>class Work{         public static void WorkThread(final Handler mHandler){             new Thread(new Runnable() {                 @Override                 public void run() {                     Message msg=new Message();                     msg.what=1;                     mHandler.sendMessage(msg);                 }             }).start();         }     } </code></pre> <p>“ <br /> WeakReference的作用就是将Activity进行弱引用，一旦Activity要被销毁时，由于Handler对Activity持有的引用是弱引用，此时，GC会及时回收Activity,防止内存泄露这就是使用弱引用的好处。但是并不是任何地方都能随便使用弱引用的，使用不当很容易造成空指针异常，所以需要合理的使用。</p> <p><strong>借鉴文章：</strong> <br /><a href="http://www.m6000.cn/wp-content/themes/begin%20lts/inc/go.php?url=http://blog.csdn.net/matrix_xu/article/details/8424038"  rel="nofollow">谈谈java中的WeakReference</a> <br /><a href="http://www.m6000.cn/wp-content/themes/begin%20lts/inc/go.php?url=http://blog.csdn.net/lincyang/article/details/46875157"  rel="nofollow">Android实战技巧之三十八：Handler使用中可能引发的内存泄漏</a> 该文章提到的另一种实现方法大家不防去试试</p> </p></div> 			                <div class="clearfix"></div>
                <div class="col-md-12 mt-5">
                                        <p>上一个：<a href="/news/article-88513.htm">宠物救助站领养宠物流程（宠物救助站领养宠物流程视频）</a></p>
                                        <p>下一个：<a href="/news/article-89244.htm">宠物领养的文案短句（宠物领养的文案短句怎么写）</a></p>
                                    </div>
                                </div>
                <div class="col-md-3">
                    <div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">热门文章</h3>
    </div>
    <div class="panel-body">
        <ul class="p-0 x-0" style="list-style: none;margin: 0;padding: 0;">
                        <li class="py-2"><a href="/free-nodes/2025-3-27-today-clash-node.htm" title="「3月27日」最高速度21M/S，2025年SSR/Shadowrocket/V2ray/Clash每天更新免费节点链接地址">「3月27日」最高速度21M/S，2025年SSR/Shadowrocket/V2ray/Clash每天更新免费节点链接地址</a></li>
                        <li class="py-2"><a href="/news/article-66044.htm" title="宠爱国际动物医院官网招聘 宠爱国际动物医院工作怎么样">宠爱国际动物医院官网招聘 宠爱国际动物医院工作怎么样</a></li>
                        <li class="py-2"><a href="/news/article-84935.htm" title="如何在MySQL DATEDIFF()函数中使用两位数的年份值？">如何在MySQL DATEDIFF()函数中使用两位数的年份值？</a></li>
                        <li class="py-2"><a href="/free-nodes/2025-3-8-free-ssr-node.htm" title="「3月8日」最高速度19.3M/S，2025年V2ray/Clash/Shadowrocket/SSR每天更新免费节点链接地址">「3月8日」最高速度19.3M/S，2025年V2ray/Clash/Shadowrocket/SSR每天更新免费节点链接地址</a></li>
                        <li class="py-2"><a href="/free-nodes/2025-3-29-clash-node.htm" title="「3月29日」最高速度18.5M/S，2025年Shadowrocket/SSR/Clash/V2ray每天更新免费节点链接地址">「3月29日」最高速度18.5M/S，2025年Shadowrocket/SSR/Clash/V2ray每天更新免费节点链接地址</a></li>
                        <li class="py-2"><a href="/news/article-78617.htm" title="时间复杂度与空间复杂度">时间复杂度与空间复杂度</a></li>
                        <li class="py-2"><a href="/news/article-75195.htm" title="动物疫苗销售许可证如何办理（动物疫苗经销商资格）">动物疫苗销售许可证如何办理（动物疫苗经销商资格）</a></li>
                        <li class="py-2"><a href="/news/article-84201.htm" title="在哪儿领养宠物（在哪里能领养宠物）">在哪儿领养宠物（在哪里能领养宠物）</a></li>
                        <li class="py-2"><a href="/free-nodes/2025-4-5-free-shadowrocket-node.htm" title="「4月5日」最高速度18.4M/S，2025年Clash/V2ray/Shadowrocket/SSR每天更新免费节点链接地址">「4月5日」最高速度18.4M/S，2025年Clash/V2ray/Shadowrocket/SSR每天更新免费节点链接地址</a></li>
                        <li class="py-2"><a href="/news/article-71198.htm" title="动物疫苗新规定最新版是什么 动物疫苗新规定最新版是什么意思">动物疫苗新规定最新版是什么 动物疫苗新规定最新版是什么意思</a></li>
                    </ul>
    </div>
</div>

<div class="panel panel-default">
    <div class="panel-heading">
        <h3 class="panel-title">归纳</h3>
    </div>
    <div class="panel-body">
        <ul class="p-0 x-0" style="list-style: none;margin: 0;padding: 0;">
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">21</span> <a href="/date/2025-04/" title="2025-04 归档">2025-04</a></h4>
            </li>
                        <li class="py-2">
                <h4><span class="badge" style="float: right;">90</span> <a href="/date/2025-03/" title="2025-03 归档">2025-03</a></h4>
            </li>
                    </ul>
    </div>
</div>

                </div>
            </div>
        </div>
    </section>
    <!-- ========================= about style-3 end ========================= -->
        <footer class="footer footer-style-1">
        <div class="container">
            <div class="copyright-wrapper wow fadeInUp" data-wow-delay=".2s">
                                    <p>
                                                <a href="/">首页</a> |
                                                <a href="/free-nodes/">免费节点</a> |
                                                <a href="/paid-subscribe/">推荐机场</a> |
                                                <a href="/client.htm">客户端</a> |
                                                <a href="/news/">新闻资讯</a> |
                                                <a href="/about-us.htm">关于我们</a> |
                        <a href="/disclaimer.htm">免责申明</a> |
                        <a href="/privacy.htm">隐私申明</a> |
                        <a href="/sitemap.xml">网站地图</a>
                    </p>
                <p>MyClash官网每日更新站 版权所有 Powered by WordPress</p>
            </div>
        </div>
    </footer>
    <!-- ========================= footer style-1 end ========================= -->
    <!-- ========================= scroll-top start ========================= -->
    <a href="#" class="scroll-top"> <i class="lni lni-chevron-up"></i> </a>
    <!-- ========================= scroll-top end ========================= -->
    <!-- ========================= JS here ========================= -->
    <script src="/assets/website/js/frontend/myclash/jquery-3.4.1.min.js"></script>
    <script src="/assets/website/js/frontend/myclash/bootstrap.5.0.0.alpha-2-min.js"></script>
    <script src="/assets/website/js/frontend/myclash/contact-form.js"></script>
    <script src="/assets/website/js/frontend/myclash/tiny-slider.js"></script>
    <script src="/assets/website/js/frontend/myclash/glightbox.min.js"></script>
    <script src="/assets/website/js/frontend/myclash/imagesloaded.min.js"></script>
    <script src="/assets/website/js/frontend/myclash/isotope.min.js"></script>
    <script src="/assets/website/js/frontend/myclash/count-up.min.js"></script>
    <script src="/assets/website/js/frontend/myclash/wow.min.js"></script>
    <script src="/assets/website/js/frontend/myclash/main.js"></script>
    <script src="https://www.freeclashnode.com/assets/js/frontend/invite-url.js"></script><script src="/assets/website/js/frontend/G.js"></script>
</body>

</html>